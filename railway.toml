[[build]]
builder = "NIXPACKS"

[[deploy]]
numReplicas = 1
healthcheckPath = "/"
healthcheckTimeout = 300
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 10

[deploy.startCommand]
# This will be overridden per service

# Query Engine Service
[[services]]
name = "query-engine"
source = "ghcr.io/lmnr-ai/query-engine"

[services.deploy]
startCommand = ""

[services.healthcheck]
path = "/"
timeout = 60

[services.env]
PORT = "8903"

[[services]]
name = "app-server"
source = "ghcr.io/lmnr-ai/app-server"

[services.deploy]
startCommand = ""

[services.healthcheck]
path = "/health"
timeout = 60

[services.env]
PORT = "8000"
GRPC_PORT = "8001"
ENVIRONMENT = "PRODUCTION"

[[services]]
name = "frontend"
source = "ghcr.io/lmnr-ai/frontend"

[services.deploy]
startCommand = ""

[services.healthcheck]
path = "/"
timeout = 60

[services.env]
PORT = "5667"
ENVIRONMENT = "PRODUCTION"

